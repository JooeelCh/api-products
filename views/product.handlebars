<div class="grid md:grid-cols-2 gap-10">

  <img src="{{product.thumbnails.[0]}}" alt="{{product.title}}" class="rounded-xl shadow-lg w-full object-cover"/>

  <div class="flex flex-col gap-4">
    <h2 class="text-4xl font-bold text-sky-900">{{product.title}}</h2>
    <p class="text-gray-600 text-lg">{{product.description}}</p>
    <h4 class="text-3xl font-semibold text-green-700 mt-4">$ {{product.price}}</h4>
    <button id="addToCartBtn"
        data-cart="{{cartId}}"
        data-product="{{product._id}}"
        class="bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg text-center text-xl transition mt-6">
        Agregar al carrito
    </button>
    <a href="/" class="border border-gray-400 hover:bg-gray-100 text-gray-700 py-3 rounded-lg text-center transition">Volver al listado</a>
  </div>

</div>

<script>
  document.getElementById("addToCartBtn").addEventListener("click", async (e) => {

    let cartId = localStorage.getItem("cartId"); // <-- importante

    const productId = e.target.dataset.product;

    if (!cartId) {
      const resp = await fetch("/api/carts", { method: "POST" });
      if (!resp.ok) return alert("Error creando carrito");

      const data = await resp.json();
      cartId = data._id;
      localStorage.setItem("cartId", cartId);
    }

    // Ahora sÃ­ agregar al carrito real
    const response = await fetch(`/api/carts/${cartId}/product/${productId}`, {
      method: "POST"
    });

    if (response.ok) {
      alert("Producto agregado");
      window.location.href = `/carts/${cartId}`;
    } else {
      alert("Error al agregar al carrito");
    }
  });
</script>
