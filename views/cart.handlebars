<h1 class="mb-8 text-4xl font-bold text-center text-sky-900">Tu Carrito</h1>

{{#if cart.products.length}}

  <div class="flex flex-col gap-5">
    {{#each cart.products}}
      <div class="bg-white shadow-lg rounded-xl p-5 flex justify-between items-center">

        <div>
          <h3 class="text-xl font-semibold">{{this.product.title}}</h3>
          <p class="text-gray-600">ðŸ’² {{this.product.price}}</p>
        </div>

        <div class="flex items-center gap-6">
          <span class="font-medium">Cantidad: {{this.quantity}}</span>
          <button class="delete-btn"
            data-cart="{{../cart._id}}"
            data-product="{{this.product._id}}">
            Eliminar
          </button>
        </div>

      </div>
    {{/each}}
  </div>

  <a href="/" class="mt-8 block bg-sky-700 hover:bg-sky-800 text-white py-3 text-center rounded-lg font-semibold">Seguir comprando</a>

{{else}}
  <div class="bg-sky-100 text-sky-900 p-6 rounded-xl text-center shadow-md">
    Tu carrito estÃ¡ vacÃ­o
  </div>
  <a href="/" class="mt-6 block bg-sky-700 hover:bg-sky-800 text-white py-3 text-center rounded-lg font-semibold">Seguir comprando</a>
{{/if}}

<script>
  document.querySelectorAll(".delete-btn").forEach(btn => {
    btn.addEventListener("click", async e => {
      const cid = e.target.dataset.cart;
      const pid = e.target.dataset.product;

      const response = await fetch(`/api/carts/${cid}/product/${pid}`, {
        method: "DELETE"
      });

      if (response.ok) {
        window.location.reload();
      } else {
        alert("No se pudo eliminar el producto");
      }
    });
  });
</script>